<!-- asset-form.html -->

<form [formGroup]="form" (ngSubmit)="save()">

  <div class="surface-card content">

    <!-- Header -->
    <div class="header">
      <div class="row-between">
        <div>
          <h2 class="page-title font-semibold m-0">
            {{ isEditMode ? 'Detalhes do Ativo' : 'Novo Ativo' }}
          </h2>

          @if (isEditMode) {
            <div class="opacity-70 text-sm mt-1">
              ID: {{ form.controls.id.value }} • Criado em: {{ form.controls.createdAt.value }} •
              Atualizado em: {{ form.controls.updatedAt.value }}
            </div>
          }
        </div>

        <div class="flex gap-2">
          <button mat-button type="button" routerLink="/assets">Voltar</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
            Salvar
          </button>
        </div>
      </div>
    </div>

    <div class="tab-body">
      <mat-tab-group>

        <!-- GENERAL -->
        <mat-tab label="Geral">
          <div class="form-grid">

            <mat-form-field appearance="fill">
              <mat-label>Nome</mat-label>
              <input matInput formControlName="name" placeholder="ex.: Volkswagen UP 1.0">
              @if (form.controls.name.touched && form.controls.name.invalid) {
                <mat-error>Nome é obrigatório</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Código</mat-label>
              <input matInput formControlName="code" placeholder="ex.: CAR-0001">
              @if (form.controls.code.touched && form.controls.code.invalid) {
                <mat-error>Código é obrigatório</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Categoria</mat-label>
              <mat-select formControlName="category">
                @for (c of assetsCategoriesKeys; track c) {
                  <mat-option [value]="c">{{ ASSET_CATEGORY_PT_BR[c] }}</mat-option>
                }
              </mat-select>
              @if (form.controls.category.touched && form.controls.category.invalid) {
                <mat-error>Categoria é obrigatória</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Status</mat-label>
              <mat-select formControlName="status">
                @for (s of assetsStatusKeys; track s) {
                  <mat-option [value]="s">{{ ASSET_STATUS_PT_BR[s] }}</mat-option>
                }
              </mat-select>
              @if (form.controls.status.touched && form.controls.status.invalid) {
                <mat-error>Status é obrigatório</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Valor de Aquisição</mat-label>
              <input matInput type="text" formControlName="acquisitionValue" placeholder="ex.: R$ 45.000,00"
                     mask="separator.2"
                     thousandSeparator="."
                     decimalMarker=","
                     prefix="R$ "
                     [dropSpecialCharacters]="true"
                     (blur)="normalizeCurrency(form, 'acquisitionValue')">
              @if (form.controls.acquisitionValue.touched && form.controls.acquisitionValue.invalid) {
                <mat-error>Valor de aquisição é obrigatório</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Data de Aquisição</mat-label>
              <input matInput formControlName="acquisitionDate"
                     mask="d0/M0/0000" placeholder="ex.: 01/01/2020">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Vida Útil Esperada (meses)</mat-label>
              <input matInput type="number" formControlName="expectedLifetimeMonths" placeholder="ex.: 60">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Localização</mat-label>
              <input matInput formControlName="location" placeholder="ex.: Garagem / Filial A">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Número de Série</mat-label>
              <input matInput formControlName="serialNumber">
            </mat-form-field>

          </div>
        </mat-tab>

        <!-- DETAILS -->
        <mat-tab label="Detalhes">
          <div class="form-grid">

            <mat-form-field appearance="fill">
              <mat-label>Marca</mat-label>
              <input matInput formControlName="brand" placeholder="ex.: Volkswagen">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Modelo</mat-label>
              <input matInput formControlName="model" placeholder="ex.: UP">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Ano do Modelo</mat-label>
              <input matInput type="number" formControlName="modelYear" placeholder="ex.: 2019">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Ano de Fabricação</mat-label>
              <input matInput type="number" formControlName="manufactureYear" placeholder="ex.: 2018">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Número da Frota</mat-label>
              <input matInput formControlName="fleetNumber">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Cor</mat-label>
              <input matInput formControlName="color">
            </mat-form-field>

          </div>
        </mat-tab>

        <!-- VEHICLE -->
        <mat-tab label="Veículo">
          <div class="form-grid">

            <mat-form-field appearance="fill">
              <mat-label>Tipo de Veículo</mat-label>
              <mat-select formControlName="vehicleType">
                @for (v of vehicleTypesKeys; track v) {
                  <mat-option [value]="v">{{ ASSET_VEHICLE_TYPE_PT_BR[v] }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Tipo de Combustível</mat-label>
              <mat-select formControlName="fuelType">
                @for (f of fuelTypesKeys; track f) {
                  <mat-option [value]="f">{{ ASSET_FUEL_TYPE_PT_BR[f] }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Transmissão</mat-label>
              <mat-select formControlName="transmissionType">
                @for (t of transmissionTypesKeys; track t) {
                  <mat-option [value]="t">{{ ASSET_TRANSMISSION_TYPE_PT_BR[t] }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Tipo de Posse</mat-label>
              <mat-select formControlName="ownershipType">
                @for (o of ownershipTypesKeys; track o) {
                  <mat-option [value]="o">{{ ASSET_OWNERSHIP_TYPE_PT_BR[o] }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Placa</mat-label>
              <input matInput formControlName="licensePlate">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Número do Chassi</mat-label>
              <input matInput formControlName="chassisNumber">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Renavam</mat-label>
              <input matInput formControlName="renavam">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Odômetro (km)</mat-label>
              <input matInput type="number" formControlName="odometerKm">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Capacidade de Passageiros</mat-label>
              <input matInput type="number" formControlName="seatingCapacity">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Quantidade de Eixos</mat-label>
              <input matInput type="number" formControlName="axleCount">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Carga Máxima (kg)</mat-label>
              <input matInput type="number" formControlName="maxLoadKg">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Cilindrada do Motor (cc)</mat-label>
              <input matInput type="number" formControlName="engineDisplacementCc">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Capacidade do Tanque (L)</mat-label>
              <input matInput type="number" formControlName="tankCapacityLiters">
            </mat-form-field>

          </div>
        </mat-tab>

        <!-- INSURANCE & DOCS -->
        <mat-tab label="Seguro / Documentos">
          <div class="form-grid">

            <mat-form-field appearance="fill">
              <mat-label>Seguradora</mat-label>
              <input matInput formControlName="insuranceCompany">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Número da Apólice</mat-label>
              <input matInput formControlName="insurancePolicyNumber">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Vencimento do Seguro</mat-label>
              <input matInput formControlName="insuranceExpiryDate"
                     mask="d0/M0/0000" placeholder="ex.: 01/01/2020">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Vencimento do Licenciamento</mat-label>
              <input matInput formControlName="registrationExpiryDate"
                     mask="d0/M0/0000" placeholder="ex.: 01/01/2020">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Condutor Atual</mat-label>
              <input matInput formControlName="currentDriver">
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>ID do Rastreador GPS</mat-label>
              <input matInput formControlName="gpsTrackerId">
            </mat-form-field>

          </div>
        </mat-tab>

        <!-- NOTES -->
        <mat-tab label="Observações">
          <div class="form-grid">
            <mat-form-field appearance="fill" class="col-span-full">
              <mat-label>Observações</mat-label>
              <textarea matInput formControlName="notes" rows="6"
                        placeholder="Qualquer informação adicional..."></textarea>
            </mat-form-field>
          </div>
        </mat-tab>

      </mat-tab-group>
    </div>

    <!-- Bottom actions -->
    <div class="actions">
      <button mat-button type="button" routerLink="/assets">Cancelar</button>
      <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
        Salvar
      </button>
    </div>

  </div>
</form>
